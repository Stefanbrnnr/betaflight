name: Build Betaflight Target

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout (master branch)
      uses: actions/checkout@v4
      with:
        ref: master
        submodules: true

    - name: *** HARD DEBUG *** Show current directory tree
      run: |
        echo "=== FULL REPO TREE ==="
        ls -R .
        echo "======================="

    - name: *** HARD DEBUG *** Show target folder
      run: |
        echo "=== TARGET FOLDER ==="
        if [ -d "src/main/target" ]; then
          ls -R src/main/target
        else
          echo "Folder src/main/target DOES NOT EXIST"
        fi
        echo "====================="

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y ninja-build python3 python3-pip ccache

    - name: Install ARM Toolchain
      run: make arm_sdk_install

    - name: Build firmware
      env:
        TARGET: BRENNER_H7
      run: |
        echo "Building $TARGET ..."
        make $TARGET
